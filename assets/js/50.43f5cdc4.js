(window.webpackJsonp=window.webpackJsonp||[]).push([[50],{335:function(a,e,s){"use strict";s.r(e);var n=s(14),t=Object(n.a)({},(function(){var a=this,e=a._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[e("h1",{attrs:{id:"package"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#package"}},[a._v("#")]),a._v(" Package")]),a._v(" "),e("p",[a._v('Las aplicaciones de empaque deben seguir el estilo "NPM":')]),a._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[a._v("npm")]),a._v(" pack\n")])])]),e("p",[e("a",{attrs:{href:"https://docs.npmjs.com/cli/pack",target:"_blank",rel:"noopener noreferrer"}},[a._v("npm pack"),e("OutboundLink")],1),a._v(" producira un "),e("code",[a._v("TGZ")]),a._v(" con tu aplicacion que puedes mover a otra localizacion.\nSin embargo, las aplicaciones tambien pueden ser "),e("a",{attrs:{href:"https://docs.npmjs.com/cli/publish",target:"_blank",rel:"noopener noreferrer"}},[a._v("publicadas"),e("OutboundLink")],1),a._v(" a un registro NPM.")]),a._v(" "),e("p",[a._v("Es importante notar que para trabajar con "),e("code",[a._v("published/packed")]),a._v(" el ambiente objetivo tiene que tener acceso a el paquete\n"),e("a",{attrs:{href:"https://www.npmjs.com/package/@es4x/create",target:"_blank",rel:"noopener noreferrer"}},[a._v("@es4x/create"),e("OutboundLink")],1),a._v(" ya que sera necesario para instalar las partes "),e("code",[a._v("java")]),a._v(".")]),a._v(" "),e("h2",{attrs:{id:"docker"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#docker"}},[a._v("#")]),a._v(" Docker")]),a._v(" "),e("p",[a._v("Imagenes Docker tambien pueden ser creadas para ti.")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("es4x dockerfile\n")])])]),e("p",[a._v("Esto producira un sencillo "),e("code",[a._v("dockerfile")]),a._v(" que puedes personalizar a tus necesidades, por defecto el archivo sera\nconstruido en 3 fases.")]),a._v(" "),e("ol",[e("li",[a._v("En la primera fase "),e("code",[a._v("node")]),a._v(" es utilizado para instalar todas las dependencias "),e("code",[a._v("NPM")])]),a._v(" "),e("li",[a._v("En la segunda fase "),e("code",[a._v("java")]),a._v(" es utilizado para instalar las dependencias "),e("code",[a._v("Maven")])]),a._v(" "),e("li",[a._v("En la fase final la imagen GraalVM es utilizada para ejecutar la aplicacion")])]),a._v(" "),e("p",[a._v("Por defecto la imagen docker "),e("a",{attrs:{href:"https://hub.docker.com/r/oracle/graalvm-ce",target:"_blank",rel:"noopener noreferrer"}},[a._v("oracle/graalvm-ce"),e("OutboundLink")],1),a._v(" es usada, pero puede ser reemplazada\ncon cualquier imagen JDK (por favor prefiere versiones 11 o superiores) con soporte para JVMCI.")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" build "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(".")]),a._v(" --build-arg "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("BASEIMAGE")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("openjdk:11\n")])])]),e("h2",{attrs:{id:"jlink"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#jlink"}},[a._v("#")]),a._v(" JLink")]),a._v(" "),e("p",[a._v("Java 11 soporta "),e("a",{attrs:{href:"https://docs.oracle.com/en/java/javase/11/tools/jlink.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("jlink"),e("OutboundLink")],1),a._v(". Puedes usar la herramienta jlink para\nmontar y optimizar un conjunto de modulos y sus dependencias en una imagen runtime personalizada.")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("es4x jlink\n")])])]),e("p",[a._v("Esto producira un runtime "),e("strong",[a._v("optimizado")]),a._v(', que significa que puede ser utilizado en lugar de depender de una instalacion\nJDK completa. Como comparacion, una aplicacion "hello world" producira un runtime de unos '),e("strong",[a._v("80Mb")]),a._v(", mientras que una\ninstalacion completa JDK necesita unos "),e("strong",[a._v("200Mb")]),a._v(".")]),a._v(" "),e("p",[a._v("Esta caracteristica puede utilizarse en colaboracion con "),e("code",[a._v("Dockerfile")]),a._v(". En lugar de usar la imagen graal base, usa la imagen\n"),e("code",[a._v("OpenJDK")]),a._v(" base. Y en la segunda fase, ejecuta jlink:")]),a._v(" "),e("div",{staticClass:"language-dockerfile extra-class"},[e("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Segunda fase (construye el cpdigo relacionado con JVM)")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token instruction"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("FROM")]),a._v(" openjdk:11 "),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("AS")]),a._v(" JVM")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token instruction"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("ARG")]),a._v(" ES4X_VERSION="),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${project.version}")])]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Copia el paso de construccion previo")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token instruction"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("COPY")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token options"}},[e("span",{pre:!0,attrs:{class:"token property"}},[a._v("--from")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[a._v("NPM")])]),a._v(" /usr/src/app /usr/src/app")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# usa el espacio de trabajo (workspace) copiado")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token instruction"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("WORKDIR")]),a._v(" /usr/src/app")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Descarga la herramienta runtime ES4X")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token instruction"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("RUN")]),a._v(" curl -sL https://github.com/reactiverse/es4x/releases/download/"),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${ES4X_VERSION}")]),a._v("/es4x-pm-"),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${ES4X_VERSION}")]),a._v("-bin.tar.gz | "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("\\")]),a._v("\n    tar zx --strip-components=1 -C /usr/local")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Instala las dependencias Java")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# fuerza a que la resolucion es4x maven solo considere dependencias de produccion")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token instruction"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("RUN")]),a._v(" es4x install --only=prod")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Crea un runtime optimizado")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token instruction"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("RUN")]),a._v(" es4x jlink -t /usr/local")]),a._v("\n")])])]),e("p",[a._v("Esto producira un runtime optimizado en jre, que puede ser usado con una pequeña imagen base en la fase final:")]),a._v(" "),e("div",{staticClass:"language-dockerfile extra-class"},[e("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[e("code",[e("span",{pre:!0,attrs:{class:"token instruction"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("FROM")]),a._v(" debian:slim")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Recoge los jars del paso previo")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token instruction"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("COPY")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token options"}},[e("span",{pre:!0,attrs:{class:"token property"}},[a._v("--from")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[a._v("JVM")])]),a._v(" /usr/local /usr/local")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token instruction"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("COPY")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token options"}},[e("span",{pre:!0,attrs:{class:"token property"}},[a._v("--from")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[a._v("JVM")])]),a._v(" /usr/src/app /usr/src/app")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# usa el espacio de trabajo (workspace) copiado")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token instruction"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("WORKDIR")]),a._v(" /usr/src/app")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Empaqueta el codigo fuente")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token instruction"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("COPY")]),a._v(" . .")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Define opciones personalizadas java para los contenedores")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token instruction"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("ENV")]),a._v(" JAVA_OPTS="),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"-XX:+UnlockExperimentalVMOptions -XX:+UseCGroupMemoryLimitForHeap -XX:+UseContainerSupport"')])]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# define el punto de entrada (entrypoint)")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token instruction"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("ENTRYPOINT")]),a._v(" [ "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"./node_modules/.bin/es4x-launcher"')]),a._v(" ]")]),a._v("\n")])])]),e("p",[a._v("Esto producira una imagen final pequeña, pero una capa (layer) mas grande ya que estas empaquetando un runtime optimizado.")])])}),[],!1,null,null,null);e.default=t.exports}}]);