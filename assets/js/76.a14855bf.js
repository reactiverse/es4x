(window.webpackJsonp=window.webpackJsonp||[]).push([[76],{449:function(s,t,a){"use strict";a.r(t);var e=a(42),n=Object(e.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"δημιουργια-πακετου"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#δημιουργια-πακετου"}},[s._v("#")]),s._v(" Δημιουργία Πακέτου")]),s._v(" "),a("p",[s._v("Για να δημιουργήσεις πακέτο πρεπεί να γίνει ώς εξήσου:")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" pack\n")])])]),a("p",[a("a",{attrs:{href:"https://docs.npmjs.com/cli/pack",target:"_blank",rel:"noopener noreferrer"}},[s._v("npm pack"),a("OutboundLink")],1),s._v(" θα παράγει ένα "),a("code",[s._v("TGZ")]),s._v(" αρχείο το οποίο μπορείς να το μεταφέρεις όπου επιθυμείς.\nΩστόσο, είναι δυνατό να "),a("a",{attrs:{href:"https://docs.npmjs.com/cli/publish",target:"_blank",rel:"noopener noreferrer"}},[s._v("δημοσιευθεί"),a("OutboundLink")],1),s._v(" και σε κάποιο NPM registry.")]),s._v(" "),a("p",[s._v("Για να δουλέψεις με το "),a("code",[s._v("published/packed")]),s._v(" είναι σημαντικό το περιβάλλον για το οποίο προορίζεται το πακέτο να έχει\nπρόσβαση στο πακέτο "),a("a",{attrs:{href:"https://www.npmjs.com/package/@es4x/create",target:"_blank",rel:"noopener noreferrer"}},[s._v("@es4x/create"),a("OutboundLink")],1),s._v(" γιατί χρειάζεται να εγκαταστήσει κάποια κομμάτια απο την "),a("code",[s._v("java")]),s._v(".")]),s._v(" "),a("h2",{attrs:{id:"docker"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker"}},[s._v("#")]),s._v(" Docker")]),s._v(" "),a("p",[s._v("Docker images μπορούν να δημιουργηθούν με ευκολία:")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("es4x dockerfile\n")])])]),a("p",[s._v("Η παραπάνω εντολή θα παράγει ένα "),a("code",[s._v("dockerfile")]),s._v(" αρχείο που μετα μπορείς να το προσαρμόσεις όπως εσυ επιθυμείς.")]),s._v(" "),a("p",[s._v("Αρχικά έχει 3 στάδια:")]),s._v(" "),a("ol",[a("li",[s._v("Στο πρώτο στάδιο η "),a("code",[s._v("node")]),s._v(" χρησιμοποιείται για να εγκαταστήσει όλες τις "),a("code",[s._v("NPM")]),s._v(" βιβλιοθήκες")]),s._v(" "),a("li",[s._v("Στο δεύτερο στάδιο η "),a("code",[s._v("java")]),s._v(" χρησιμοποιείται για να εγκαταστήσει όλες τις "),a("code",[s._v("Maven")]),s._v(" βιβλιοθήκες")]),s._v(" "),a("li",[s._v("Τέλος, η GraalVM image χρησιμοποιείται για ξεκινήσει η εφαρμογη.")])]),s._v(" "),a("p",[s._v("Ως προεπιλογή χρησιμοποιείται το "),a("a",{attrs:{href:"https://hub.docker.com/r/oracle/graalvm-ce",target:"_blank",rel:"noopener noreferrer"}},[s._v("oracle/graalvm-ce"),a("OutboundLink")],1),s._v(" docker image, αλλά μπορεί να αντικατασταθεί\nαπό οποιοδήποτε άλλο JDK image (καλύτερα να είναι >11) με υποστήριξη για JVMCI.")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("docker build "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" --build-arg "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("BASEIMAGE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("openjdk:11\n")])])]),a("h2",{attrs:{id:"jlink"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jlink"}},[s._v("#")]),s._v(" JLink")]),s._v(" "),a("p",[s._v("Η Java 11 υποστηρίζει το "),a("a",{attrs:{href:"https://docs.oracle.com/en/java/javase/11/tools/jlink.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("jlink"),a("OutboundLink")],1),s._v(".")]),s._v(" "),a("p",[s._v("Μπορείς να το χρησιμοποιήσεις για δημιουργήσεις και να βελτιώσεις κάποια modules και τις βιβλιοθήκες τους και να δημιουργήσεις το δικό σου runtime image.")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("es4x jlink\n")])])]),a("p",[s._v("H παραπάνω εντολή θα παράγει "),a("code",[s._v("βελτιστοποιημένο")]),s._v(" χρόνο εκτέλεσης, πράγμα που σημαίνει ότι μπορεί να χρησιμοποιηθεί αντί να βασίζεται σε μια πλήρη εγκατάσταση JDK.\nΣυγκριτικά, μια εφαρμογή hello world θα καταναλώνει "),a("code",[s._v("80Mb")]),s._v(", ενώ μια πλήρης εγκατάσταση JDK απαιτεί περίπου "),a("code",[s._v("200Mb")]),s._v(".")]),s._v(" "),a("p",[s._v("Αυτή η δυνατότητα μπορεί να χρησιμοποιηθεί σε συνεργασία με το "),a("code",[s._v("Dockerfile")]),s._v(". Αντί να χρησιμοποιήσεις τη βασική image, χρησιμοποίησε τη βασική image "),a("code",[s._v("OpenJDK")]),s._v(".\nΣτη συνέχεια, στο δεύτερο στάδιο, εκτέλεσε το jlink:")]),s._v(" "),a("div",{staticClass:"language-dockerfile extra-class"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Second stage (build the JVM related code)")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" openjdk"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("11 AS JVM\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ARG")]),s._v(" ES4X_VERSION=$"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("project.version"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# force es4x maven resolution only to consider production dependencies")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" ES4X_ENV=production\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Copy the previous build step")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("from=NPM /usr/src/app /usr/src/app\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# use the copied workspace")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WORKDIR")]),s._v(" /usr/src/app\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Download the ES4X runtime tool")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" curl "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("sL https"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//github.com/reactiverse/es4x/releases/download/$"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("ES4X_VERSION"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("/es4x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("pm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("$"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("ES4X_VERSION"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("bin.tar.gz "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),s._v(" \\\n    tar zx "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("strip"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("components=1 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("C /usr/local\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Install the Java Dependencies")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" es4x install "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("f\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Create the optimized runtime")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" es4x jlink "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("t /usr/local\n")])])]),a("p",[s._v("Αυτό θα παράγει το βελτιστοποιημένο χρόνο εκτέλεσης στο jre, το οποίο μπορεί να χρησιμοποιηθεί με μια μικρή base image για το τελικό στάδιο:")]),s._v(" "),a("div",{staticClass:"language-dockerfile extra-class"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" debian"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("slim\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Collect the jars from the previous step")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("from=JVM /usr/local /usr/local\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("from=JVM /usr/src/app /usr/src/app\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# use the copied workspace")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WORKDIR")]),s._v(" /usr/src/app\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Bundle app source")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" . .\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Define custom java options for containers")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" JAVA_OPTS="),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-XX:+UnlockExperimentalVMOptions -XX:+UseCGroupMemoryLimitForHeap -XX:+UseContainerSupport"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# define the entrypoint")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENTRYPOINT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./node_modules/.bin/es4x-launcher"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])])]),a("p",[s._v("Αυτό θα παράγει μια μικρή final image, αλλά ένα μεγαλύτερο layer καθώς συσκευάζετε και τον βελτιστοποιημένο χρόνο εκτέλεσης.")])])}),[],!1,null,null,null);t.default=n.exports}}]);