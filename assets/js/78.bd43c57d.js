(window.webpackJsonp=window.webpackJsonp||[]).push([[78],{370:function(s,e,t){"use strict";t.r(e);var a=t(14),r=Object(a.a)({},(function(){var s=this,e=s._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"δημιουργια-πακετου"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#δημιουργια-πακετου"}},[s._v("#")]),s._v(" Δημιουργία Πακέτου")]),s._v(" "),e("p",[s._v("Για να δημιουργήσεις πακέτο πρεπεί να γίνει ώς εξήσου:")]),s._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" pack\n")])])]),e("p",[e("a",{attrs:{href:"https://docs.npmjs.com/cli/pack",target:"_blank",rel:"noopener noreferrer"}},[s._v("npm pack"),e("OutboundLink")],1),s._v(" θα παράγει ένα "),e("code",[s._v("TGZ")]),s._v(" αρχείο το οποίο μπορείς να το μεταφέρεις όπου επιθυμείς.\nΩστόσο, είναι δυνατό να "),e("a",{attrs:{href:"https://docs.npmjs.com/cli/publish",target:"_blank",rel:"noopener noreferrer"}},[s._v("δημοσιευθεί"),e("OutboundLink")],1),s._v(" και σε κάποιο NPM registry.")]),s._v(" "),e("p",[s._v("Για να δουλέψεις με το "),e("code",[s._v("published/packed")]),s._v(" είναι σημαντικό το περιβάλλον για το οποίο προορίζεται το πακέτο να έχει\nπρόσβαση στο πακέτο "),e("a",{attrs:{href:"https://www.npmjs.com/package/@es4x/create",target:"_blank",rel:"noopener noreferrer"}},[s._v("@es4x/create"),e("OutboundLink")],1),s._v(" γιατί χρειάζεται να εγκαταστήσει κάποια κομμάτια απο την "),e("code",[s._v("java")]),s._v(".")]),s._v(" "),e("h2",{attrs:{id:"docker"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#docker"}},[s._v("#")]),s._v(" Docker")]),s._v(" "),e("p",[s._v("Docker images μπορούν να δημιουργηθούν με ευκολία:")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("es4x dockerfile\n")])])]),e("p",[s._v("Η παραπάνω εντολή θα παράγει ένα "),e("code",[s._v("dockerfile")]),s._v(" αρχείο που μετα μπορείς να το προσαρμόσεις όπως εσυ επιθυμείς.")]),s._v(" "),e("p",[s._v("Αρχικά έχει 3 στάδια:")]),s._v(" "),e("ol",[e("li",[s._v("Στο πρώτο στάδιο η "),e("code",[s._v("node")]),s._v(" χρησιμοποιείται για να εγκαταστήσει όλες τις "),e("code",[s._v("NPM")]),s._v(" βιβλιοθήκες")]),s._v(" "),e("li",[s._v("Στο δεύτερο στάδιο η "),e("code",[s._v("java")]),s._v(" χρησιμοποιείται για να εγκαταστήσει όλες τις "),e("code",[s._v("Maven")]),s._v(" βιβλιοθήκες")]),s._v(" "),e("li",[s._v("Τέλος, η GraalVM image χρησιμοποιείται για ξεκινήσει η εφαρμογη.")])]),s._v(" "),e("p",[s._v("Ως προεπιλογή χρησιμοποιείται το "),e("a",{attrs:{href:"https://hub.docker.com/r/oracle/graalvm-ce",target:"_blank",rel:"noopener noreferrer"}},[s._v("oracle/graalvm-ce"),e("OutboundLink")],1),s._v(" docker image, αλλά μπορεί να αντικατασταθεί\nαπό οποιοδήποτε άλλο JDK image (καλύτερα να είναι >11) με υποστήριξη για JVMCI.")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" build "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" --build-arg "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("BASEIMAGE")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("openjdk:11\n")])])]),e("h2",{attrs:{id:"jlink"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#jlink"}},[s._v("#")]),s._v(" JLink")]),s._v(" "),e("p",[s._v("Η Java 11 υποστηρίζει το "),e("a",{attrs:{href:"https://docs.oracle.com/en/java/javase/11/tools/jlink.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("jlink"),e("OutboundLink")],1),s._v(".")]),s._v(" "),e("p",[s._v("Μπορείς να το χρησιμοποιήσεις για δημιουργήσεις και να βελτιώσεις κάποια modules και τις βιβλιοθήκες τους και να δημιουργήσεις το δικό σου runtime image.")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("es4x jlink\n")])])]),e("p",[s._v("H παραπάνω εντολή θα παράγει "),e("code",[s._v("βελτιστοποιημένο")]),s._v(" χρόνο εκτέλεσης, πράγμα που σημαίνει ότι μπορεί να χρησιμοποιηθεί αντί να βασίζεται σε μια πλήρη εγκατάσταση JDK.\nΣυγκριτικά, μια εφαρμογή hello world θα καταναλώνει "),e("code",[s._v("80Mb")]),s._v(", ενώ μια πλήρης εγκατάσταση JDK απαιτεί περίπου "),e("code",[s._v("200Mb")]),s._v(".")]),s._v(" "),e("p",[s._v("Αυτή η δυνατότητα μπορεί να χρησιμοποιηθεί σε συνεργασία με το "),e("code",[s._v("Dockerfile")]),s._v(". Αντί να χρησιμοποιήσεις τη βασική image, χρησιμοποίησε τη βασική image "),e("code",[s._v("OpenJDK")]),s._v(".\nΣτη συνέχεια, στο δεύτερο στάδιο, εκτέλεσε το jlink:")]),s._v(" "),e("div",{staticClass:"language-dockerfile extra-class"},[e("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Second stage (build the JVM related code)")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token instruction"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" openjdk:11 "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AS")]),s._v(" JVM")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token instruction"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ARG")]),s._v(" ES4X_VERSION="),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${project.version}")])]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Copy the previous build step")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token instruction"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token options"}},[e("span",{pre:!0,attrs:{class:"token property"}},[s._v("--from")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("NPM")])]),s._v(" /usr/src/app /usr/src/app")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# use the copied workspace")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token instruction"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WORKDIR")]),s._v(" /usr/src/app")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Download the ES4X runtime tool")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token instruction"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" curl -sL https://github.com/reactiverse/es4x/releases/download/"),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${ES4X_VERSION}")]),s._v("/es4x-pm-"),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${ES4X_VERSION}")]),s._v("-bin.tar.gz | "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("\\")]),s._v("\n    tar zx --strip-components=1 -C /usr/local")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Install the Java Dependencies")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# force es4x maven resolution only to consider production dependencies")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token instruction"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" es4x install --only-prod")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Create the optimized runtime")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token instruction"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" es4x jlink -t /usr/local")]),s._v("\n")])])]),e("p",[s._v("Αυτό θα παράγει το βελτιστοποιημένο χρόνο εκτέλεσης στο jre, το οποίο μπορεί να χρησιμοποιηθεί με μια μικρή base image για το τελικό στάδιο:")]),s._v(" "),e("div",{staticClass:"language-dockerfile extra-class"},[e("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[e("code",[e("span",{pre:!0,attrs:{class:"token instruction"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" debian:slim")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Collect the jars from the previous step")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token instruction"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token options"}},[e("span",{pre:!0,attrs:{class:"token property"}},[s._v("--from")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("JVM")])]),s._v(" /usr/local /usr/local")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token instruction"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token options"}},[e("span",{pre:!0,attrs:{class:"token property"}},[s._v("--from")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("JVM")])]),s._v(" /usr/src/app /usr/src/app")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# use the copied workspace")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token instruction"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WORKDIR")]),s._v(" /usr/src/app")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Bundle app source")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token instruction"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" . .")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Define custom java options for containers")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token instruction"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" JAVA_OPTS="),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-XX:+UnlockExperimentalVMOptions -XX:+UseCGroupMemoryLimitForHeap -XX:+UseContainerSupport"')])]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# define the entrypoint")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token instruction"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENTRYPOINT")]),s._v(" [ "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./node_modules/.bin/es4x-launcher"')]),s._v(" ]")]),s._v("\n")])])]),e("p",[s._v("Αυτό θα παράγει μια μικρή final image, αλλά ένα μεγαλύτερο layer καθώς συσκευάζετε και τον βελτιστοποιημένο χρόνο εκτέλεσης.")])])}),[],!1,null,null,null);e.default=r.exports}}]);